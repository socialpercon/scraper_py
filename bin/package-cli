#!/usr/bin/env python

import sys
import traceback

from package_name import cli

PACKAGE_NAME = "package_name"
COMMANDS = {}

def run_sh():
    cli.SHELL_MODE = True
    try:
        import readline
        readline.set_completer_delims(' \t\n;')
        readline.parse_and_bind("tab: complete")
    except ImportError:
        pass

    while True:
        try:
            line = raw_input("[{0}] ".format(PACKAGE_NAME))
        except EOFError:
            print "exit"
            break
        except KeyboardInterrupt:
            print "^C"
            break

        if not line:
            continue

        argv = line.split()

        try:
            run_cmd(argv)
        except SystemExit:
            pass
        except KeyboardInterrupt:
            print "^C"
            break
        except:
            traceback.print_exc()


def load_modules():
    global COMMANDS

    for name in cli.__all__:
        __import__("package_name.cli.%s" % name) # TODO dynamic package_name by var
        COMMANDS[name] = getattr(cli, name)

def print_help(*args):
    pass


def run_cmd(args):
    pass


def main():
    load_modules()

    if len(sys.argv) < 2:
        print_help()
    else:
        run_cmd(sys.argv[1:])

if __name__ == '__main__':
    main()
